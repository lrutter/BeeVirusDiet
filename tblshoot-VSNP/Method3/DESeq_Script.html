<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="generator" content="pandoc" />

    <meta name="author" content="Lindsay Rutter" />
  
  
  <title>Honey Bees - DESeq</title>

    <script src="DESeq_Script_files/jquery-1.11.3/jquery.min.js"></script>
  <link href="DESeq_Script_files/bootstrap-3.3.2/css/bootstrap.min.css" rel="stylesheet" />
  <script src="DESeq_Script_files/bootstrap-3.3.2/js/bootstrap.min.js"></script>
  <script src="DESeq_Script_files/bootstrap-3.3.2/shim/html5shiv.min.js"></script>
  <script src="DESeq_Script_files/bootstrap-3.3.2/shim/respond.min.js"></script>
  <link href="DESeq_Script_files/highlight-8.4/tomorrow.css" rel="stylesheet" />
  <script src="DESeq_Script_files/highlight-8.4/highlight.pack.js"></script>
  <link href="DESeq_Script_files/fontawesome-4.3.0/css/font-awesome.min.css" rel="stylesheet" />
  <script src="DESeq_Script_files/stickykit-1.1.1/sticky-kit.min.js"></script>
  <script src="DESeq_Script_files/jqueryeasing-1.3/jquery.easing.min.js"></script>
  <link href="DESeq_Script_files/recliner-0.2.2/recliner.css" rel="stylesheet" />
  <script src="DESeq_Script_files/recliner-0.2.2/recliner.min.js"></script>
  <script src="DESeq_Script_files/recliner-0.2.2/onload.js"></script>
  <link href="DESeq_Script_files/packagedocs-0.0.1/pd.css" rel="stylesheet" />
  <script src="DESeq_Script_files/packagedocs-0.0.1/pd.js"></script>
  <script src="DESeq_Script_files/packagedocs-0.0.1/pd-collapse-toc.js"></script>
  
  
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
</head>

<body>

  
  <header class="navbar navbar-white navbar-fixed-top" role="banner" id="header">
    <div class="container">
      <div class="navbar-header">
        <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
                <a href="index.html" class="navbar-brand page-scroll">
        Honey Bees - DESeq
        </a>
      </div>
          </div>
  </header>

  <!-- Begin Body -->
  <div class="container">
    <div class="row">
            <div class="col-md-12">
      
<div id="content-top"></div>
<p><meta http-equiv="content-type" content="text/html;charset=utf-8" /></p>
<pre class="r"><code>library(DESeq2)
thisPath &lt;- &quot;/Users/lindz/BeeVirusDiet/tblshoot-VSNP/Method3&quot;

dat &lt;- read.delim(file=&quot;/Users/lindz/BeeVirusDiet/AllLaneCount.txt&quot;,row.names=1,stringsAsFactors = FALSE)
colnames(dat) &lt;- c(&quot;NC.1&quot;, &quot;NC.2&quot;, &quot;NR.1&quot;, &quot;VR.1&quot;, &quot;NS.1&quot;, &quot;VP.1&quot;, &quot;NS.2&quot;, &quot;VR.2&quot;, &quot;NP.1&quot;, &quot;VP.2&quot;, &quot;VC.1&quot;, &quot;NP.2&quot;, &quot;VP.3&quot;, &quot;NP.3&quot;, &quot;VS.1&quot;, &quot;VS.2&quot;, &quot;VC.2&quot;, &quot;NC.3&quot;, &quot;VP.4&quot;, &quot;NC.4&quot;, &quot;NR.2&quot;, &quot;VC.3&quot;, &quot;VC.4&quot;, &quot;NP.4&quot;, &quot;VR.3&quot;, &quot;NC.5&quot;, &quot;VS.3&quot;, &quot;NP.5&quot;, &quot;VC.5&quot;, &quot;VS.4&quot;, &quot;NS.3&quot;, &quot;VS.5&quot;, &quot;VP.5&quot;, &quot;NR.3&quot;, &quot;NR.4&quot;, &quot;VC.6&quot;, &quot;NS.4&quot;, &quot;NC.6&quot;, &quot;NP.6&quot;, &quot;VR.4&quot;, &quot;NR.5&quot;, &quot;NR.6&quot;, &quot;NS.5&quot;, &quot;VP.6&quot;, &quot;NS.6&quot;, &quot;VR.5&quot;, &quot;VR.6&quot;, &quot;VS.6&quot;)
countdata &lt;- dat[ , order(names(dat))]
countdata &lt;- as.matrix(countdata)
coldata &lt;- data.frame(row.names = colnames(countdata), virus = unlist(lapply(colnames(countdata), function (x) substring(unlist(strsplit(x, &quot;[.]&quot;))[1],1,1))), diet = unlist(lapply(colnames(countdata), function (x) substring(unlist(strsplit(x, &quot;[.]&quot;))[1],2,2))), treatment = unlist(lapply(colnames(countdata), function (x) unlist(strsplit(x, &quot;[.]&quot;))[1])))</code></pre>
<p>We can examine pairwise combinations of all samples</p>
<pre class="r"><code>uTreat &lt;- unique(unlist(lapply(colnames(countdata), function (x) unlist(strsplit(x, &quot;[.]&quot;))[1])))
allPairs = data.frame(Treatment1 = factor(), Treatment2 = factor(), NumberDEG = numeric())

for (i in 1:(length(uTreat)-1)){
  for (j in (i+1):length(uTreat)){
    sampleIndex &lt;- which(sapply(colnames(countdata), function(x) unlist(strsplit(x,&quot;[.]&quot;))[1]) %in% c(uTreat[i], uTreat[j]))
    subCountData &lt;- countdata[, sampleIndex]
    sampleIndex2 &lt;- which(coldata$treatment %in% c(uTreat[i], uTreat[j]))
    subColData &lt;- coldata[sampleIndex2,]
    dds = DESeqDataSetFromMatrix(countData = subCountData, colData = subColData, design = ~ treatment)
    dds &lt;- DESeq(dds)
    res &lt;- results(dds, contrast=c(&quot;treatment&quot;,uTreat[i],uTreat[j]))
    rld &lt;- rlog(dds)
    degLength &lt;- length(which((res@listData)$padj &lt;0.05))
    allPairs = rbind(allPairs, data.frame(Treatment1 = uTreat[i], Treatment2 = uTreat[j], NumberDEG = degLength))
    saveRDS(list(dds, res, rld), paste0(&quot;comparisonData/&quot;, uTreat[i], &quot;_&quot;, uTreat[j], &quot;.rds&quot;))
  }
}</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre><code>factor levels were dropped which had no samples</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre class="r"><code>allPairs &lt;- allPairs[order(allPairs$NumberDEG),]
allPairs</code></pre>
<pre><code>   Treatment1 Treatment2 NumberDEG
4          NC         VC         2
19         NS         VC         2
3          NC         NS         6
8          NP         NR         9
1          NC         NP        10
25         VC         VS        15
22         NS         VS        20
23         VC         VP        20
11         NP         VP        24
26         VP         VR        31
5          NC         VP        40
27         VP         VS        42
7          NC         VS       112
16         NR         VP       122
17         NR         VR       151
20         NS         VP       366
12         NP         VR       419
10         NP         VC       428
24         VC         VR       481
6          NC         VR       669
2          NC         NR       680
15         NR         VC       855
28         VR         VS      1113
21         NS         VR      1821
9          NP         NS      2396
13         NP         VS      2850
14         NR         NS      2864
18         NR         VS      3044</code></pre>
<pre class="r"><code>plotMA(res)</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-65-1.png" width="960" /></p>
<pre class="r"><code>plotDispEsts(dds, ylim = c(1e-6, 1e1))</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-66-1.png" width="960" /></p>
<p>The histogram of p-values does not look too good.</p>
<pre class="r"><code>hist( res$pvalue, breaks=20, col=&quot;grey&quot; )</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-67-1.png" width="960" /></p>
<p>Below has y-axis that doesn’t add to 1 for some reason (neither does the example in the vignette)</p>
<pre class="r"><code># create bins using the quantile function
qs &lt;- c( 0, quantile( res$baseMean[res$baseMean &gt; 0], 0:7/7 ) )
# &quot;cut&quot; the genes into the bins
bins &lt;- cut( res$baseMean, qs )
# rename the levels of the bins using the middle point
levels(bins) &lt;- paste0(&quot;~&quot;,round(.5*qs[-1] + .5*qs[-length(qs)]))
# calculate the ratio of £p£ values less than .01 for each bin
ratios &lt;- tapply( res$pvalue, bins, function(p) mean( p &lt; .01, na.rm=TRUE ) ) # plot these ratios
barplot(ratios, xlab=&quot;mean normalized count&quot;, ylab=&quot;ratio of small $p$ values&quot;)</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-68-1.png" width="960" /></p>
<p>Taking rlog transformation for EDA.</p>
<pre class="r"><code>rld &lt;- rlog(dds)
par( mfrow = c(1, 2))
plot(log2(1+counts(dds, normalized=TRUE)[, 1:2] ), col=&quot;#00000020&quot;, pch=20, cex=0.3)
plot(assay(rld)[, c(2,3)], col=&quot;#00000020&quot;, pch=20, cex=0.3)</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-69-1.png" width="960" /></p>
<pre class="r"><code>sampleDists &lt;- dist( t( assay(rld) ) )
sampleDists</code></pre>
<pre><code>         VR.1     VR.2     VR.3     VR.4     VR.5     VR.6     VS.1
VR.2 49.87545                                                      
VR.3 43.90208 30.22975                                             
VR.4 42.33434 41.04080 35.34843                                    
VR.5 36.11493 45.35944 40.27903 36.78790                           
VR.6 52.52324 41.97534 39.15606 36.23119 50.76783                  
VS.1 51.00124 57.74733 53.17125 44.02513 59.93102 46.22815         
VS.2 42.94448 40.28700 37.89681 34.50978 45.45429 43.40911 37.13155
VS.3 46.44306 34.70833 34.59019 37.90393 47.82111 43.11267 48.16679
VS.4 42.77485 39.30787 34.69104 34.50369 45.82794 37.58443 37.31922
VS.5 38.12931 41.42825 36.47518 33.83178 42.81680 40.78993 36.29416
VS.6 38.50545 44.96866 40.73988 39.37944 40.00108 52.02990 46.98333
         VS.2     VS.3     VS.4     VS.5
VR.2                                    
VR.3                                    
VR.4                                    
VR.5                                    
VR.6                                    
VS.1                                    
VS.2                                    
VS.3 33.26704                           
VS.4 30.34458 33.62545                  
VS.5 29.40802 34.38664 25.88534         
VS.6 32.80100 43.56876 37.32953 33.58784</code></pre>
<pre class="r"><code>sampleDistMatrix &lt;- as.matrix(sampleDists)
rownames(sampleDistMatrix) &lt;- paste(rld$treatment, rld$patient, sep=&quot;-&quot;)
colnames(sampleDistMatrix) &lt;- NULL
library(&quot;gplots&quot;)
library(&quot;RColorBrewer&quot;)
colours = colorRampPalette(rev(brewer.pal(9, &quot;Blues&quot;)))(255)
heatmap.2(sampleDistMatrix, trace=&quot;none&quot;, col=colours)</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-71-1.png" width="960" /></p>
<pre class="r"><code>print(plotPCA(rld, intgroup=&quot;treatment&quot;) )</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-72-1.png" width="960" /></p>
<pre class="r"><code>#topVarGenes &lt;- head( order( rowVars( assay(rld) ), decreasing=TRUE ), 35 )
#heatmap.2( assay(rld)[ topVarGenes, ], scale=&quot;row&quot;, trace=&quot;none&quot;, dendrogram=&quot;column&quot;, col = colorRampPalette( rev(brewer.pal(9, &quot;RdBu&quot;)) )(255))</code></pre>


      </div>
    </div>
  </div>

  <div id="footer">
    <div class="container">
      <div class="col-md-6">
              </div>
      <div class="col-md-6">
        <p class="pull-right">created with <a href="https://github.com/hafen/packagedocs">packagedocs</a>
                  </p>
      </div>
    </div>
  </div>

  
</body>
</html>
