<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="generator" content="pandoc" />

    <meta name="author" content="Lindsay Rutter" />
  
  
  <title>Honey Bees - edgeR (check p-values after blocking day)</title>

    <script src="edgeR_Script_files/jquery-1.11.3/jquery.min.js"></script>
  <link href="edgeR_Script_files/bootstrap-3.3.2/css/bootstrap.min.css" rel="stylesheet" />
  <script src="edgeR_Script_files/bootstrap-3.3.2/js/bootstrap.min.js"></script>
  <script src="edgeR_Script_files/bootstrap-3.3.2/shim/html5shiv.min.js"></script>
  <script src="edgeR_Script_files/bootstrap-3.3.2/shim/respond.min.js"></script>
  <link href="edgeR_Script_files/highlight-8.4/tomorrow.css" rel="stylesheet" />
  <script src="edgeR_Script_files/highlight-8.4/highlight.pack.js"></script>
  <link href="edgeR_Script_files/fontawesome-4.3.0/css/font-awesome.min.css" rel="stylesheet" />
  <script src="edgeR_Script_files/stickykit-1.1.1/sticky-kit.min.js"></script>
  <script src="edgeR_Script_files/jqueryeasing-1.3/jquery.easing.min.js"></script>
  <link href="edgeR_Script_files/recliner-0.2.2/recliner.css" rel="stylesheet" />
  <script src="edgeR_Script_files/recliner-0.2.2/recliner.min.js"></script>
  <script src="edgeR_Script_files/recliner-0.2.2/onload.js"></script>
  <link href="edgeR_Script_files/packagedocs-0.0.1/pd.css" rel="stylesheet" />
  <script src="edgeR_Script_files/packagedocs-0.0.1/pd.js"></script>
  <script src="edgeR_Script_files/packagedocs-0.0.1/pd-collapse-toc.js"></script>
  
  
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
</head>

<body>

  
  <header class="navbar navbar-white navbar-fixed-top" role="banner" id="header">
    <div class="container">
      <div class="navbar-header">
        <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
                <a href="index.html" class="navbar-brand page-scroll">
        Honey Bees - edgeR (check p-values after blocking day)
        </a>
      </div>
          </div>
  </header>

  <!-- Begin Body -->
  <div class="container">
    <div class="row">
            <div class="col-md-12">
      
<div id="content-top"></div>
<p><meta http-equiv="content-type" content="text/html;charset=utf-8" /></p>
<pre class="r"><code>library(edgeR)</code></pre>
<pre><code>Loading required package: limma</code></pre>
<pre class="r"><code>library(ggplot2)
library(GGally)
library(EDASeq)</code></pre>
<pre><code>Loading required package: Biobase</code></pre>
<pre><code>Loading required package: BiocGenerics</code></pre>
<pre><code>Loading required package: parallel</code></pre>
<pre><code>
Attaching package: &#39;BiocGenerics&#39;</code></pre>
<pre><code>The following objects are masked from &#39;package:parallel&#39;:

    clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,
    clusterExport, clusterMap, parApply, parCapply, parLapply,
    parLapplyLB, parRapply, parSapply, parSapplyLB</code></pre>
<pre><code>The following object is masked from &#39;package:limma&#39;:

    plotMA</code></pre>
<pre><code>The following objects are masked from &#39;package:stats&#39;:

    IQR, mad, sd, var, xtabs</code></pre>
<pre><code>The following objects are masked from &#39;package:base&#39;:

    anyDuplicated, append, as.data.frame, cbind, colMeans,
    colnames, colSums, do.call, duplicated, eval, evalq, Filter,
    Find, get, grep, grepl, intersect, is.unsorted, lapply,
    lengths, Map, mapply, match, mget, order, paste, pmax,
    pmax.int, pmin, pmin.int, Position, rank, rbind, Reduce,
    rowMeans, rownames, rowSums, sapply, setdiff, sort, table,
    tapply, union, unique, unsplit, which, which.max, which.min</code></pre>
<pre><code>Welcome to Bioconductor

    Vignettes contain introductory material; view with
    &#39;browseVignettes()&#39;. To cite Bioconductor, see
    &#39;citation(&quot;Biobase&quot;)&#39;, and for packages &#39;citation(&quot;pkgname&quot;)&#39;.</code></pre>
<pre><code>Loading required package: ShortRead</code></pre>
<pre><code>Loading required package: BiocParallel</code></pre>
<pre><code>Loading required package: Biostrings</code></pre>
<pre><code>Loading required package: S4Vectors</code></pre>
<pre><code>Loading required package: stats4</code></pre>
<pre><code>
Attaching package: &#39;S4Vectors&#39;</code></pre>
<pre><code>The following object is masked from &#39;package:base&#39;:

    expand.grid</code></pre>
<pre><code>Loading required package: IRanges</code></pre>
<pre><code>Loading required package: XVector</code></pre>
<pre><code>
Attaching package: &#39;Biostrings&#39;</code></pre>
<pre><code>The following object is masked from &#39;package:base&#39;:

    strsplit</code></pre>
<pre><code>Loading required package: Rsamtools</code></pre>
<pre><code>Loading required package: GenomeInfoDb</code></pre>
<pre><code>Loading required package: GenomicRanges</code></pre>
<pre><code>Loading required package: GenomicAlignments</code></pre>
<pre><code>Loading required package: SummarizedExperiment</code></pre>
<pre><code>Loading required package: DelayedArray</code></pre>
<pre><code>Loading required package: matrixStats</code></pre>
<pre><code>
Attaching package: &#39;matrixStats&#39;</code></pre>
<pre><code>The following objects are masked from &#39;package:Biobase&#39;:

    anyMissing, rowMedians</code></pre>
<pre><code>
Attaching package: &#39;DelayedArray&#39;</code></pre>
<pre><code>The following objects are masked from &#39;package:matrixStats&#39;:

    colMaxs, colMins, colRanges, rowMaxs, rowMins, rowRanges</code></pre>
<pre><code>The following object is masked from &#39;package:Biostrings&#39;:

    type</code></pre>
<pre><code>The following object is masked from &#39;package:base&#39;:

    apply</code></pre>
<pre class="r"><code>library(utils)

thisPath &lt;- &quot;/Users/lindz/BeeVirusDiet/checkPval/Block_Day&quot;
dir.create(paste(thisPath, &quot;/DEGPairs&quot;, sep=&quot;&quot;))</code></pre>
<pre><code>Warning in dir.create(paste(thisPath, &quot;/DEGPairs&quot;, sep = &quot;&quot;)): &#39;/Users/
lindz/BeeVirusDiet/checkPval/Block_Day/DEGPairs&#39; already exists</code></pre>
<pre class="r"><code>dir.create(paste(thisPath, &quot;/pvalPlots&quot;, sep=&quot;&quot;))</code></pre>
<pre><code>Warning in dir.create(paste(thisPath, &quot;/pvalPlots&quot;, sep = &quot;&quot;)): &#39;/Users/
lindz/BeeVirusDiet/checkPval/Block_Day/pvalPlots&#39; already exists</code></pre>
<pre class="r"><code>beeCounts &lt;-read.delim(file=&quot;../../AllLaneCount.txt&quot;,row.names=1,stringsAsFactors = FALSE)

colnames(beeCounts) &lt;- c(&quot;NC.1&quot;, &quot;NC.2&quot;, &quot;NR.1&quot;, &quot;VR.1&quot;, &quot;NS.1&quot;, &quot;VP.1&quot;, &quot;NS.2&quot;, &quot;VR.2&quot;, &quot;NP.1&quot;, &quot;VP.2&quot;, &quot;VC.1&quot;, &quot;NP.2&quot;, &quot;VP.3&quot;, &quot;NP.3&quot;, &quot;VS.1&quot;, &quot;VS.2&quot;, &quot;VC.2&quot;, &quot;NC.3&quot;, &quot;VP.4&quot;, &quot;NC.4&quot;, &quot;NR.2&quot;, &quot;VC.3&quot;, &quot;VC.4&quot;, &quot;NP.4&quot;, &quot;VR.3&quot;, &quot;NC.5&quot;, &quot;VS.3&quot;, &quot;NP.5&quot;, &quot;VC.5&quot;, &quot;VS.4&quot;, &quot;NS.3&quot;, &quot;VS.5&quot;, &quot;VP.5&quot;, &quot;NR.3&quot;, &quot;NR.4&quot;, &quot;VC.6&quot;, &quot;NS.4&quot;, &quot;NC.6&quot;, &quot;NP.6&quot;, &quot;VR.4&quot;, &quot;NR.5&quot;, &quot;NR.6&quot;, &quot;NS.5&quot;, &quot;VP.6&quot;, &quot;NS.6&quot;, &quot;VR.5&quot;, &quot;VR.6&quot;, &quot;VS.6&quot;)

beeCounts &lt;- beeCounts[ , order(names(beeCounts))]

y &lt;- DGEList(counts=beeCounts)

exVars &lt;- read.csv(&quot;/Users/lindz/bigPint/tblshoot/CheckAllVars/extraVarClean.csv&quot;)</code></pre>
<p>edgeR vignette states that a gene is required to have a count of 5-10 in a library to be considered expressed in that library. Here minLib is equal to 3.04425910^{6}. A CPM of 3 corresponds to a count of ~9 in the minimum number of samples in a group (24). So, I keep only rows that have that. This reduces the number of genes from 15,314 to 8,581.</p>
<pre class="r"><code>minLib &lt;- min(y$samples$lib.size)
keep &lt;- rowSums(cpm(y)&gt;3) &gt;= 24
# Number of genes 15,314--&gt; 8,581
y &lt;- y[keep, , keep.lib.sizes=FALSE]</code></pre>
<p>Next, I used edgeR normalization.</p>
<pre class="r"><code>y &lt;- calcNormFactors(y)</code></pre>
<p>I can create boxplot and RLE boxplot.</p>
<pre class="r"><code>ggparcoord(data.frame(y[[1]]), columns=1:48, alphaLines=0, boxplot=TRUE, scale=&quot;globalminmax&quot;) + coord_flip()</code></pre>
<p><img src="edgeR_Script_files/figure-html/unnamed-chunk-4-1.png" width="960" /></p>
<pre class="r"><code>ggparcoord(data.frame(log(y[[1]]/colMeans(y[[1]]))), columns=1:48, alphaLines=0, boxplot=TRUE, scale=&quot;globalminmax&quot;) + coord_flip()</code></pre>
<pre><code>Warning: Removed 56 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="edgeR_Script_files/figure-html/unnamed-chunk-4-2.png" width="960" /></p>
<p>I can create MDS plots of interest.</p>
<pre class="r"><code>allGroups &lt;- c(rep(&quot;NC&quot;,6), rep(&quot;NP&quot;,6), rep(&quot;NR&quot;,6), rep(&quot;NS&quot;,6), rep(&quot;VC&quot;,6), rep(&quot;VP&quot;,6), rep(&quot;VR&quot;,6), rep(&quot;VS&quot;,6))
y$samples$group &lt;- allGroups

plotMDS(y, col = c(&quot;red&quot;,&quot;deeppink&quot;,&quot;darkorange&quot;,&quot;gold&quot;,&quot;green2&quot;, &quot;green4&quot;,&quot;blue&quot;, &quot;purple&quot;)[factor(allGroups)], cex=0.6)</code></pre>
<p><img src="edgeR_Script_files/figure-html/unnamed-chunk-5-1.png" width="960" /></p>
<pre class="r"><code>plotMDS(y, col = c(&quot;blue&quot;,&quot;blue&quot;,&quot;blue&quot;,&quot;blue&quot;,&quot;red&quot;,&quot;red&quot;,&quot;red&quot;,&quot;red&quot;)[factor(allGroups)], cex=0.6)</code></pre>
<p><img src="edgeR_Script_files/figure-html/unnamed-chunk-5-2.png" width="960" /></p>
<pre class="r"><code>plotMDS(y, col = c(&quot;white&quot;,&quot;blue&quot;,&quot;white&quot;,&quot;red&quot;,&quot;white&quot;,&quot;white&quot;,&quot;white&quot;,&quot;white&quot;)[factor(allGroups)], cex=0.6)</code></pre>
<p><img src="edgeR_Script_files/figure-html/unnamed-chunk-5-3.png" width="960" /></p>
<pre class="r"><code>plotMDS(y, col = c(&quot;white&quot;,&quot;white&quot;,&quot;white&quot;,&quot;white&quot;,&quot;white&quot;,&quot;blue&quot;,&quot;white&quot;,&quot;red&quot;)[factor(allGroups)], cex=0.6)</code></pre>
<p><img src="edgeR_Script_files/figure-html/unnamed-chunk-5-4.png" width="960" /></p>
<pre class="r"><code>plotMDS(y, col = c(&quot;white&quot;,&quot;blue&quot;,&quot;white&quot;,&quot;white&quot;,&quot;white&quot;,&quot;white&quot;,&quot;white&quot;,&quot;red&quot;)[factor(allGroups)], cex=0.6)</code></pre>
<p><img src="edgeR_Script_files/figure-html/unnamed-chunk-5-5.png" width="960" /></p>
<p>Copying Section (3.4.2 in edgeR vignette)</p>
<pre class="r"><code>Group = factor(c(rep(&quot;NC&quot;,6), rep(&quot;NP&quot;,6), rep(&quot;NR&quot;,6), rep(&quot;NS&quot;,6), rep(&quot;VC&quot;,6), rep(&quot;VP&quot;,6), rep(&quot;VR&quot;,6), rep(&quot;VS&quot;,6)))
Day = as.factor(exVars$Day)
design &lt;- model.matrix(~0+Group+Day)
colnames(design)[1:8] &lt;- levels(Group)
y &lt;- estimateDisp(y, design)
plotBCV(y)</code></pre>
<p><img src="edgeR_Script_files/figure-html/unnamed-chunk-6-1.png" width="960" /></p>
<pre class="r"><code>fit &lt;- glmFit(y, design)

myContrasts &lt;- makeContrasts(
  VvsN = (VC+VS+VP+VR)-(NC+NS+NP+NR),
  NSvsNP = NS-NP,
  VSvsVP = VS-VP,
  NPvsVS = NP-VS,
  NSNPvVSVP = (NS-NP)-(VS-VP),
levels=design)</code></pre>
<p>Below we save the DEGs from all pairwise combinations of treatment groups.</p>
<pre class="r"><code>allPairs = data.frame(Treatment1 = factor(), Treatment2 = factor(), NumberDEG = numeric(), FirstLarger = numeric(), SecondLarger = numeric())

for (i in 1:(length(levels(Group))-1)){
  for (j in (i+1):length(levels(Group))){
    contrast=rep(0,ncol(fit))
    contrast[i]=1
    contrast[j]=-1
    lrt &lt;- glmLRT(fit, contrast=contrast)
    lrt &lt;- topTags(lrt, n = nrow(y[[1]]))[[1]]
    
    pVals &lt;- data.frame(x = lrt$PValue)

p &lt;- ggplot(pVals, aes(x=x)) + geom_histogram() + xlab(&quot;p-value&quot;) + ylab(&quot;Gene count&quot;) #+ ggtitle(paste0(colnames(fit)[1], &quot; versus &quot;, colnames(fit)[2]))
jpeg(filename = paste0(thisPath, &quot;/pvalPlots/&quot;, colnames(fit)[i], &quot;_&quot;, colnames(fit)[j],&quot;.jpg&quot;))
print(p)
dev.off()
    
    saveRDS(lrt, file=paste0(thisPath, &quot;/DEGPairs/&quot;, colnames(fit)[i], colnames(fit)[j],&quot;.Rds&quot;))
    
    lrt &lt;- lrt[which(lrt$FDR&lt;0.05),]
    lrtLength &lt;- nrow(lrt)
    allPairs = rbind(allPairs, data.frame(Treatment1 = factor(colnames(fit)[i]), Treatment2 = factor(colnames(fit)[j]), NumberDEG = lrtLength))
  }
}
allPairs &lt;- allPairs[order(allPairs$NumberDEG),]
saveRDS(allPairs, file=paste0(thisPath, &quot;/DEGPairs/allPairs.Rds&quot;))</code></pre>
<pre class="r"><code>allPairs</code></pre>
<pre><code>   Treatment1 Treatment2 NumberDEG
1          NC         NP         0
3          NC         NS         0
4          NC         VC         0
19         NS         VC         0
22         NS         VS         0
25         VC         VS         0
7          NC         VS         3
26         VP         VR        14
11         NP         VP        21
5          NC         VP        24
23         VC         VP        30
17         NR         VR        82
8          NP         NR       140
27         VP         VS       146
16         NR         VP       153
24         VC         VR       241
28         VR         VS       379
12         NP         VR       536
6          NC         VR       605
10         NP         VC       646
15         NR         VC       831
2          NC         NR       886
20         NS         VP      1256
21         NS         VR      1600
18         NR         VS      2105
13         NP         VS      2392
14         NR         NS      2745
9          NP         NS      2754</code></pre>


      </div>
    </div>
  </div>

  <div id="footer">
    <div class="container">
      <div class="col-md-6">
              </div>
      <div class="col-md-6">
        <p class="pull-right">created with <a href="https://github.com/hafen/packagedocs">packagedocs</a>
                  </p>
      </div>
    </div>
  </div>

  
</body>
</html>
