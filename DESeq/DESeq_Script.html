<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="generator" content="pandoc" />

    <meta name="author" content="Lindsay Rutter" />
  
  
  <title>Honey Bees - DESeq</title>

    <script src="DESeq_Script_files/jquery-1.11.3/jquery.min.js"></script>
  <link href="DESeq_Script_files/bootstrap-3.3.2/css/bootstrap.min.css" rel="stylesheet" />
  <script src="DESeq_Script_files/bootstrap-3.3.2/js/bootstrap.min.js"></script>
  <script src="DESeq_Script_files/bootstrap-3.3.2/shim/html5shiv.min.js"></script>
  <script src="DESeq_Script_files/bootstrap-3.3.2/shim/respond.min.js"></script>
  <link href="DESeq_Script_files/highlight-8.4/tomorrow.css" rel="stylesheet" />
  <script src="DESeq_Script_files/highlight-8.4/highlight.pack.js"></script>
  <link href="DESeq_Script_files/fontawesome-4.3.0/css/font-awesome.min.css" rel="stylesheet" />
  <script src="DESeq_Script_files/stickykit-1.1.1/sticky-kit.min.js"></script>
  <script src="DESeq_Script_files/jqueryeasing-1.3/jquery.easing.min.js"></script>
  <link href="DESeq_Script_files/recliner-0.2.2/recliner.css" rel="stylesheet" />
  <script src="DESeq_Script_files/recliner-0.2.2/recliner.min.js"></script>
  <script src="DESeq_Script_files/recliner-0.2.2/onload.js"></script>
  <link href="DESeq_Script_files/packagedocs-0.0.1/pd.css" rel="stylesheet" />
  <script src="DESeq_Script_files/packagedocs-0.0.1/pd.js"></script>
  <script src="DESeq_Script_files/packagedocs-0.0.1/pd-collapse-toc.js"></script>
  
  
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
</head>

<body>

  
  <header class="navbar navbar-white navbar-fixed-top" role="banner" id="header">
    <div class="container">
      <div class="navbar-header">
        <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
                <a href="index.html" class="navbar-brand page-scroll">
        Honey Bees - DESeq
        </a>
      </div>
          </div>
  </header>

  <!-- Begin Body -->
  <div class="container">
    <div class="row">
            <div class="col-md-12">
      
<div id="content-top"></div>
<p><meta http-equiv="content-type" content="text/html;charset=utf-8" /></p>
<pre class="r"><code>library(DESeq2)

thisPath &lt;- &quot;/Users/lindz/BeeVirusDiet/DESeq&quot;

beeCounts &lt;-read.delim(file=&quot;../AllLaneCount.txt&quot;,row.names=1,stringsAsFactors = FALSE)
colnames(beeCounts) &lt;- c(&quot;NC.1&quot;, &quot;NC.2&quot;, &quot;NR.1&quot;, &quot;VR.1&quot;, &quot;NS.1&quot;, &quot;VP.1&quot;, &quot;NS.2&quot;, &quot;VR.2&quot;, &quot;NP.1&quot;, &quot;VP.2&quot;, &quot;VC.1&quot;, &quot;NP.2&quot;, &quot;VP.3&quot;, &quot;NP.3&quot;, &quot;VS.1&quot;, &quot;VS.2&quot;, &quot;VC.2&quot;, &quot;NC.3&quot;, &quot;VP.4&quot;, &quot;NC.4&quot;, &quot;NR.2&quot;, &quot;VC.3&quot;, &quot;VC.4&quot;, &quot;NP.4&quot;, &quot;VR.3&quot;, &quot;NC.5&quot;, &quot;VS.3&quot;, &quot;NP.5&quot;, &quot;VC.5&quot;, &quot;VS.4&quot;, &quot;NS.3&quot;, &quot;VS.5&quot;, &quot;VP.5&quot;, &quot;NR.3&quot;, &quot;NR.4&quot;, &quot;VC.6&quot;, &quot;NS.4&quot;, &quot;NC.6&quot;, &quot;NP.6&quot;, &quot;VR.4&quot;, &quot;NR.5&quot;, &quot;NR.6&quot;, &quot;NS.5&quot;, &quot;VP.6&quot;, &quot;NS.6&quot;, &quot;VR.5&quot;, &quot;VR.6&quot;, &quot;VS.6&quot;)
countdata &lt;- beeCounts[ , order(names(beeCounts))]
countdata &lt;- as.matrix(countdata)

coldata = data.frame(row.names = colnames(countdata), virus = unlist(lapply(colnames(countdata), function (x) substring(unlist(strsplit(x, &quot;[.]&quot;))[1],1,1))), diet = unlist(lapply(colnames(countdata), function (x) substring(unlist(strsplit(x, &quot;[.]&quot;))[1],2,2))), treatment = unlist(lapply(colnames(countdata), function (x) unlist(strsplit(x, &quot;[.]&quot;))[1])))

# Not sure which to do
#dds = DESeqDataSetFromMatrix(countData = countdata, colData = coldata, design = ~ virus + diet + virus:diet)
#dds = DESeqDataSetFromMatrix(countData = countdata, colData = coldata, design = ~ virus + diet + virus:diet)
dds = DESeqDataSetFromMatrix(countData = countdata, colData = coldata, design = ~ treatment)
dds &lt;- DESeq(dds)</code></pre>
<pre><code>estimating size factors</code></pre>
<pre><code>estimating dispersions</code></pre>
<pre><code>gene-wise dispersion estimates</code></pre>
<pre><code>mean-dispersion relationship</code></pre>
<pre><code>final dispersion estimates</code></pre>
<pre><code>fitting model and testing</code></pre>
<pre class="r"><code>res &lt;- results(dds, contrast=c(&quot;treatment&quot;,&quot;NC&quot;,&quot;NP&quot;))</code></pre>
<p>We can examine pairwise combinations of all samples</p>
<pre class="r"><code>uTreat &lt;- unique(unlist(lapply(colnames(countdata), function (x) unlist(strsplit(x, &quot;[.]&quot;))[1])))

allPairs = data.frame(Treatment1 = factor(), Treatment2 = factor(), NumberDEG = numeric())

for (i in 1:(length(uTreat)-1)){
  for (j in (i+1):length(uTreat)){
    res &lt;- results(dds, contrast=c(&quot;treatment&quot;,uTreat[i],uTreat[j]))
    #saveRDS(res, file=paste0(thisPath, &quot;/DEGPairs/&quot;, colnames(fit)[i], colnames(fit)[j],&quot;.Rds&quot;))
    degLength &lt;- length(which((res@listData)$padj &lt;0.05))
    allPairs = rbind(allPairs, data.frame(Treatment1 = uTreat[i], Treatment2 = uTreat[j], NumberDEG = degLength))
  }
}
allPairs &lt;- allPairs[order(allPairs$NumberDEG),]
allPairs</code></pre>
<pre><code>   Treatment1 Treatment2 NumberDEG
3          NC         NS         0
4          NC         VC         0
19         NS         VC         0
22         NS         VS         0
7          NC         VS         3
25         VC         VS         3
1          NC         NP        14
26         VP         VR        47
23         VC         VP        53
5          NC         VP        81
11         NP         VP        89
8          NP         NR       133
17         NR         VR       155
27         VP         VS       217
16         NR         VP       219
24         VC         VR       225
28         VR         VS       298
10         NP         VC       579
6          NC         VR       630
15         NR         VC       726
12         NP         VR       745
2          NC         NR       798
20         NS         VP      1192
21         NS         VR      1530
18         NR         VS      2190
13         NP         VS      2494
14         NR         NS      2784
9          NP         NS      2826</code></pre>
<pre class="r"><code>plotMA(res, ylim = c(-1, 1000000), xlim=c(-1, 200000))</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-115-1.png" width="960" /></p>
<pre class="r"><code>plotDispEsts(dds, ylim = c(1e-6, 1e1))</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-116-1.png" width="960" /></p>
<p>The histogram of p-values does not look too good.</p>
<pre class="r"><code>hist( res$pvalue, breaks=20, col=&quot;grey&quot; )</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-117-1.png" width="960" /></p>
<p>Below has y-axis that doesn’t add to 1 for some reason (neither does the example in the vignette)</p>
<pre class="r"><code># create bins using the quantile function
qs &lt;- c( 0, quantile( res$baseMean[res$baseMean &gt; 0], 0:7/7 ) )
# &quot;cut&quot; the genes into the bins
bins &lt;- cut( res$baseMean, qs )
# rename the levels of the bins using the middle point
levels(bins) &lt;- paste0(&quot;~&quot;,round(.5*qs[-1] + .5*qs[-length(qs)]))
# calculate the ratio of £p£ values less than .01 for each bin
ratios &lt;- tapply( res$pvalue, bins, function(p) mean( p &lt; .01, na.rm=TRUE ) ) # plot these ratios
barplot(ratios, xlab=&quot;mean normalized count&quot;, ylab=&quot;ratio of small $p$ values&quot;)</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-118-1.png" width="960" /></p>
<p>Taking rlog transformation for EDA.</p>
<pre class="r"><code>rld &lt;- rlog(dds)
par( mfrow = c(1, 2))
plot(log2(1+counts(dds, normalized=TRUE)[, 1:2] ), col=&quot;#00000020&quot;, pch=20, cex=0.3)
plot(assay(rld)[, 1:2], col=&quot;#00000020&quot;, pch=20, cex=0.3)</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-119-1.png" width="960" /></p>
<pre class="r"><code>sampleDists &lt;- dist( t( assay(rld) ) )
sampleDists</code></pre>
<pre><code>         NC.1     NC.2     NC.3     NC.4     NC.5     NC.6     NP.1
NC.2 36.33412                                                      
NC.3 61.78893 64.67158                                             
NC.4 49.53559 50.39101 45.54976                                    
NC.5 38.41845 36.96102 60.45182 47.13012                           
NC.6 60.05383 64.70166 41.98416 43.66645 58.79905                  
NP.1 46.68847 49.38276 58.35298 50.35176 40.35754 55.40535         
NP.2 56.57565 48.27560 82.92805 67.30823 51.32246 80.88179 58.05632
NP.3 47.96594 51.65042 50.21923 50.50404 45.43367 49.62439 46.82860
NP.4 46.96401 47.19627 63.47942 57.13544 41.19268 60.37480 46.19716
NP.5 44.75819 49.73089 59.64370 55.69528 46.19405 62.09676 48.50082
NP.6 48.29810 53.94805 41.67134 40.98540 48.54943 34.92032 47.32639
NR.1 44.46415 52.59967 56.74465 50.59588 48.66608 48.91143 52.42918
NR.2 51.98266 58.65851 71.27148 67.44559 56.57615 68.61361 56.65949
NR.3 41.97006 47.17858 71.29079 59.42175 45.77750 68.28765 50.65616
NR.4 41.72468 50.28644 47.44131 49.03642 46.99027 44.08704 49.01723
NR.5 46.52945 51.32175 53.19670 52.34958 45.51058 51.94211 48.20716
NR.6 48.55553 54.49030 44.21391 46.98057 50.37416 43.00576 46.50194
NS.1 56.50919 60.23177 54.79453 48.28359 53.71924 53.57200 52.98131
NS.2 37.78750 41.08248 46.87845 36.77963 40.97452 43.97873 45.42490
NS.3 49.07069 51.24769 48.86378 48.28513 56.63180 61.01243 63.72767
NS.4 58.22374 61.03206 35.00426 41.72663 58.47682 44.02232 56.80255
         NP.2     NP.3     NP.4     NP.5     NP.6     NR.1     NR.2
NC.2                                                               
NC.3                                                               
NC.4                                                               
NC.5                                                               
NC.6                                                               
NP.1                                                               
NP.2                                                               
NP.3 66.86703                                                      
NP.4 61.03878 40.79790                                             
NP.5 61.93567 42.59622 47.94558                                    
NP.6 72.29220 42.97422 50.77698 53.88814                           
NR.1 69.82111 39.95428 44.84443 42.29257 45.22718                  
NR.2 72.90204 47.54069 42.85037 56.50310 58.98092 49.80969         
NR.3 57.01768 54.13112 53.22808 53.65370 59.74103 54.23707 54.80702
NR.4 70.88013 37.33282 47.90362 45.54074 37.88374 38.55319 52.34021
NR.5 67.42672 34.25736 36.30508 43.07138 44.91952 38.68009 41.57254
NR.6 71.34639 37.85543 44.38948 50.23088 37.15228 43.59308 48.19118
NS.1 71.89502 51.76026 61.03896 46.42397 53.42926 47.02410 72.11265
NS.2 63.15650 43.24191 46.19492 47.57681 38.21465 39.29325 55.04166
NS.3 75.01556 53.44461 59.48953 50.12962 51.65199 53.69629 64.24115
NS.4 79.18405 50.71303 63.71573 55.59506 41.16038 53.17142 70.79839
         NR.3     NR.4     NR.5     NR.6     NS.1     NS.2     NS.3
NC.2                                                               
NC.3                                                               
NC.4                                                               
NC.5                                                               
NC.6                                                               
NP.1                                                               
NP.2                                                               
NP.3                                                               
NP.4                                                               
NP.5                                                               
NP.6                                                               
NR.1                                                               
NR.2                                                               
NR.3                                                               
NR.4 53.86631                                                      
NR.5 50.38913 40.32643                                             
NR.6 57.42925 37.61363 36.14316                                    
NS.1 63.18980 51.87222 54.37512 55.06458                           
NS.2 48.84345 37.49478 42.91148 41.52546 46.50804                  
NS.3 66.43672 50.04333 52.80709 50.30009 59.66837 45.89282         
NS.4 70.46330 46.59991 53.89668 44.21805 49.89015 44.76063 45.19843
         NS.4     NS.5     NS.6     VC.1     VC.2     VC.3     VC.4
NC.2                                                               
NC.3                                                               
NC.4                                                               
NC.5                                                               
NC.6                                                               
NP.1                                                               
NP.2                                                               
NP.3                                                               
NP.4                                                               
NP.5                                                               
NP.6                                                               
NR.1                                                               
NR.2                                                               
NR.3                                                               
NR.4                                                               
NR.5                                                               
NR.6                                                               
NS.1                                                               
NS.2                                                               
NS.3                                                               
NS.4                                                               
         VC.5     VC.6     VP.1     VP.2     VP.3     VP.4     VP.5
NC.2                                                               
NC.3                                                               
NC.4                                                               
NC.5                                                               
NC.6                                                               
NP.1                                                               
NP.2                                                               
NP.3                                                               
NP.4                                                               
NP.5                                                               
NP.6                                                               
NR.1                                                               
NR.2                                                               
NR.3                                                               
NR.4                                                               
NR.5                                                               
NR.6                                                               
NS.1                                                               
NS.2                                                               
NS.3                                                               
NS.4                                                               
         VP.6     VR.1     VR.2     VR.3     VR.4     VR.5     VR.6
NC.2                                                               
NC.3                                                               
NC.4                                                               
NC.5                                                               
NC.6                                                               
NP.1                                                               
NP.2                                                               
NP.3                                                               
NP.4                                                               
NP.5                                                               
NP.6                                                               
NR.1                                                               
NR.2                                                               
NR.3                                                               
NR.4                                                               
NR.5                                                               
NR.6                                                               
NS.1                                                               
NS.2                                                               
NS.3                                                               
NS.4                                                               
         VS.1     VS.2     VS.3     VS.4     VS.5
NC.2                                             
NC.3                                             
NC.4                                             
NC.5                                             
NC.6                                             
NP.1                                             
NP.2                                             
NP.3                                             
NP.4                                             
NP.5                                             
NP.6                                             
NR.1                                             
NR.2                                             
NR.3                                             
NR.4                                             
NR.5                                             
NR.6                                             
NS.1                                             
NS.2                                             
NS.3                                             
NS.4                                             
 [ reached getOption(&quot;max.print&quot;) -- omitted 26 rows ]</code></pre>
<pre class="r"><code>sampleDistMatrix &lt;- as.matrix(sampleDists)
rownames(sampleDistMatrix) &lt;- paste(rld$treatment, rld$patient, sep=&quot;-&quot;)
colnames(sampleDistMatrix) &lt;- NULL
library(&quot;gplots&quot;)
library(&quot;RColorBrewer&quot;)
colours = colorRampPalette(rev(brewer.pal(9, &quot;Blues&quot;)))(255)
heatmap.2(sampleDistMatrix, trace=&quot;none&quot;, col=colours)</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-121-1.png" width="960" /></p>
<pre class="r"><code>print(plotPCA(rld, intgroup=&quot;treatment&quot;) )</code></pre>
<p><img src="DESeq_Script_files/figure-html/unnamed-chunk-122-1.png" width="960" /></p>
<pre class="r"><code>#topVarGenes &lt;- head( order( rowVars( assay(rld) ), decreasing=TRUE ), 35 )
#heatmap.2( assay(rld)[ topVarGenes, ], scale=&quot;row&quot;, trace=&quot;none&quot;, dendrogram=&quot;column&quot;, col = colorRampPalette( rev(brewer.pal(9, &quot;RdBu&quot;)) )(255))</code></pre>


      </div>
    </div>
  </div>

  <div id="footer">
    <div class="container">
      <div class="col-md-6">
              </div>
      <div class="col-md-6">
        <p class="pull-right">created with <a href="https://github.com/hafen/packagedocs">packagedocs</a>
                  </p>
      </div>
    </div>
  </div>

  
</body>
</html>
